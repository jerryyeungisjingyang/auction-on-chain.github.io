(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{7:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>p});var a=n(5155),i=n(2115),u=n(6096),s=n(3346),r=n(415),l=n(2619),o=n.n(l);function p(){let[t,e]=(0,i.useState)(""),[n,l]=(0,i.useState)(""),[p,g]=(0,i.useState)(""),[f,b]=(0,i.useState)(""),[h,x]=(0,i.useState)(""),[v,w]=(0,i.useState)(""),[M,S]=(0,i.useState)(""),[j,D]=(0,i.useState)(!1),[I,T]=(0,i.useState)("");async function A(e){e.preventDefault(),T("");try{D(!0);let e=await (0,r.hS)(),a=(0,s.wP)(e),i=await a.startTrade(t,u.Dg(n||"0"),BigInt(Math.floor(new Date(p).getTime()/1e3)),BigInt(Math.floor(new Date(f).getTime()/1e3)),u.Dg(h||"0"),u.Dg(v||"0"));await i.wait();let l=await a.setTradeItemInfo(t,M.trim());await l.wait(),T("创建成功")}catch(t){T("object"==typeof t&&null!==t&&"message"in t?String(t.message):"交易失败")}finally{D(!1)}}return(0,a.jsxs)("div",{style:{padding:24,margin:"0 auto",maxWidth:720},children:[(0,a.jsx)("div",{style:{marginBottom:12},children:(0,a.jsx)(o(),{href:"/",style:{color:"#0f766e"},children:"← 返回首页"})}),(0,a.jsx)("h2",{style:{fontSize:22,fontWeight:600},children:"发起拍卖"}),(0,a.jsxs)("form",{onSubmit:A,style:{marginTop:16,display:"grid",gap:12},children:[(0,a.jsxs)(d,{label:"交易ID",children:[(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)("input",{value:t,onChange:t=>e(t.target.value),required:!0,style:{...y,flex:1}}),(0,a.jsx)("button",{type:"button",onClick:function(){let t=new Date,n=t.getFullYear().toString(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0"),r=Math.random().toString(36).slice(2,6);e("item-".concat(n).concat(a).concat(i,"-").concat(u).concat(s,"-").concat(r))},style:c,children:"生成ID"})]}),(0,a.jsx)("div",{style:{fontSize:12,color:"#6b7280",marginTop:6},children:"推荐格式：item-YYYYMMDD-HHMM-xxxx；确保唯一后再分享给买家。"})]}),(0,a.jsx)(d,{label:"出售数量",children:(0,a.jsx)("input",{type:"number",min:"0",value:n,onChange:t=>l(t.target.value),required:!0,style:y})}),(0,a.jsx)(d,{label:"开始时间",children:(0,a.jsx)("input",{type:"datetime-local",value:p,onChange:t=>g(t.target.value),required:!0,style:y})}),(0,a.jsx)(d,{label:"结束时间",children:(0,a.jsx)("input",{type:"datetime-local",value:f,onChange:t=>b(t.target.value),required:!0,style:y})}),(0,a.jsx)(d,{label:"最少竞拍数量",children:(0,a.jsx)("input",{type:"number",min:"0",value:h,onChange:t=>x(t.target.value),required:!0,style:y})}),(0,a.jsx)(d,{label:"每单位起拍价",children:(0,a.jsx)("input",{type:"number",min:"0",value:v,onChange:t=>w(t.target.value),required:!0,style:y})}),(0,a.jsx)(d,{label:"物品信息",children:(0,a.jsx)("textarea",{value:M,onChange:t=>S(t.target.value),rows:3,placeholder:"标题/规格/描述等（必填）",required:!0,style:{...y,resize:"vertical"}})}),(0,a.jsx)("div",{style:{display:"flex",gap:12,marginTop:4},children:(0,a.jsx)("button",{disabled:j,style:m,children:j?"提交中...":"创建"})}),I&&(0,a.jsx)("div",{style:{color:I.includes("成功")?"#065f46":"#b91c1c"},children:I})]})]})}function d(t){let{label:e,children:n}=t;return(0,a.jsxs)("label",{style:{display:"grid",gap:6},children:[(0,a.jsx)("span",{style:{fontSize:14,color:"#374151"},children:e}),n]})}let y={padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:8},m={padding:"10px 14px",background:"#0f766e",color:"#fff",borderRadius:8},c={padding:"10px 14px",background:"#fff",color:"#111827",border:"1px solid #e5e7eb",borderRadius:8}},415:(t,e,n)=>{"use strict";n.d(e,{hS:()=>u});var a=n(5242);function i(t){return"object"==typeof t&&null!==t&&"request"in t}async function u(){let t=function(){let t=function(){let{ethereum:t}=window;if(!t)return null;if(Array.isArray(t.providers)){let e=t.providers.find(t=>null==t?void 0:t.isMetaMask);if(e&&i(e))return e}return t.isMetaMask&&i(t)||i(t)?t:null}();if(!t)throw Error("未检测到 MetaMask，请安装或启用 MetaMask 扩展");return new a.k(t)}();return await t.send("eth_requestAccounts",[]),await t.getSigner()}},678:(t,e,n)=>{Promise.resolve().then(n.bind(n,7))},3346:(t,e,n)=>{"use strict";n.d(e,{wP:()=>u});var a=n(8678);let i=[{type:"function",name:"getAllownance",stateMutability:"view",inputs:[{name:"user",type:"address"}],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"getFrozenAllowance",stateMutability:"view",inputs:[{name:"user",type:"address"}],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"getTrade",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"seller",type:"address"},{name:"sellAmount",type:"uint256"},{name:"startTimeStamp",type:"uint256"},{name:"endTimeStamp",type:"uint256"},{name:"minimumBidAmount",type:"uint256"},{name:"initPriceOfUint",type:"uint256"}]},{type:"function",name:"getTradeDeposit",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"getAuctionAmount",stateMutability:"view",inputs:[],outputs:[{name:"",type:"uint256"}]},{type:"function",name:"startTrade",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"amount",type:"uint256"},{name:"startTimeStamp",type:"uint256"},{name:"endTimeStamp",type:"uint256"},{name:"minimumBidAmount",type:"uint256"},{name:"initPriceOfUint",type:"uint256"}],outputs:[]},{type:"function",name:"deposit",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"amount",type:"uint256"},{name:"info",type:"string"}],outputs:[]},{type:"function",name:"refundDeposit",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"}],outputs:[]},{type:"function",name:"setBidInfo",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"info",type:"string"}],outputs:[]},{type:"function",name:"setBidSecret",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"secret",type:"string"}],outputs:[]},{type:"function",name:"setTradeItemInfo",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"info",type:"string"}],outputs:[]},{type:"function",name:"getTradeItemInfo",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"string"}]},{type:"function",name:"getBidInfo",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"string"}]},{type:"function",name:"getBidSecret",stateMutability:"view",inputs:[{name:"tradeID",type:"string"}],outputs:[{name:"",type:"string"}]},{type:"function",name:"finalizeAuctionAndTransferCarbon",stateMutability:"nonpayable",inputs:[{name:"tradeID",type:"string"},{name:"allowanceAmount",type:"uint256"},{name:"additionalAmountToPay",type:"uint256"}],outputs:[]},{type:"function",name:"withdrawAuctionAmount",stateMutability:"nonpayable",inputs:[],outputs:[]}];function u(t){return new a.NZ("0x0000000000000000000000000000000000000001",i,t)}}},t=>{t.O(0,[619,242,441,255,358],()=>t(t.s=678)),_N_E=t.O()}]);